{"ast":null,"code":"import axios from 'axios';\n// API endpoints\nconst BACKEND_API_URL = 'http://localhost:8000';\nconst MOCK_API_URL = 'http://localhost:3001';\nclass ApiService {\n  // Fetch stores from mock API\n  async getStores() {\n    try {\n      // Prefer backend proxy so frontend only talks to our backend\n      const response = await axios.get(`${BACKEND_API_URL}/api/dashboard/stores`);\n      const body = response.data;\n      // Normalize possible shapes:\n      // - { stores: [...] }\n      // - [...] (array)\n      // - { data: [...] }\n      if (Array.isArray(body)) return body;\n      if (Array.isArray(body === null || body === void 0 ? void 0 : body.stores)) return body.stores;\n      if (Array.isArray(body === null || body === void 0 ? void 0 : body.data)) return body.data;\n      // fallback: try to extract enumerable array-like properties\n      return [];\n    } catch (error) {\n      console.error('Error fetching stores:', error);\n      throw error;\n    }\n  }\n\n  // Fetch dashboard summary from backend\n  async getDashboardSummary() {\n    const response = await axios.get(`${BACKEND_API_URL}/api/dashboard/summary`);\n    return response.data;\n  }\n\n  // Fetch combined store info (store + orders + metrics)\n  async getDashboardStore(storeId) {\n    const response = await axios.get(`${BACKEND_API_URL}/api/dashboard/store/${storeId}`);\n    return response.data;\n  }\n\n  // Fetch store metrics from backend\n  async getStoreMetrics(storeId) {\n    try {\n      // TODO: Implement this to call your backend\n      const response = await axios.get(`${BACKEND_API_URL}/api/metrics/store/${storeId}`);\n      return response.data;\n    } catch (error) {\n      console.error('Error fetching metrics:', error);\n      // Return mock data for now\n      return {\n        store_id: storeId,\n        total_orders_24h: 0,\n        total_orders_1h: 0,\n        success_rate: 0,\n        failure_rate: 0,\n        avg_processing_time_minutes: 0,\n        total_revenue_24h: 0,\n        avg_order_value: 0,\n        orders_per_hour: 0,\n        error_breakdown: {},\n        timestamp: new Date().toISOString()\n      };\n    }\n  }\n\n  // Fetch health score from backend\n  async getHealthScore(storeId) {\n    try {\n      // TODO: Implement this to call your backend\n      const response = await axios.get(`${BACKEND_API_URL}/api/health-score/${storeId}`);\n      return response.data;\n    } catch (error) {\n      console.error('Error fetching health score:', error);\n      // Return mock data for now\n      return {\n        store_id: storeId,\n        score: 75,\n        status: 'healthy',\n        factors: {\n          success_rate: 85,\n          processing_time: 70,\n          revenue_trend: 75\n        },\n        timestamp: new Date().toISOString()\n      };\n    }\n  }\n\n  // Fetch orders from mock API\n  async getOrders(storeId, limit = 20) {\n    try {\n      const response = await axios.get(`${MOCK_API_URL}/api/stores/${storeId}/orders`, {\n        params: {\n          limit\n        }\n      });\n      return response.data.orders;\n    } catch (error) {\n      console.error('Error fetching orders:', error);\n      return [];\n    }\n  }\n\n  // Detect anomalies\n  async detectAnomalies(storeId) {\n    try {\n      // TODO: Implement this to call your backend\n      const response = await axios.get(`${BACKEND_API_URL}/api/anomalies/detect`, {\n        params: {\n          store_id: storeId\n        }\n      });\n      return response.data;\n    } catch (error) {\n      console.error('Error detecting anomalies:', error);\n      return [];\n    }\n  }\n\n  // Connect to WebSocket for real-time orders\n  connectToOrderStream(onMessage) {\n    const ws = new WebSocket('ws://localhost:8000/ws/orders');\n    ws.onmessage = event => {\n      try {\n        const data = JSON.parse(event.data);\n        if (data.type === 'new_order') {\n          onMessage(data.data);\n        }\n      } catch (error) {\n        console.error('WebSocket message error:', error);\n      }\n    };\n    ws.onerror = error => {\n      console.error('WebSocket error:', error);\n    };\n    return ws;\n  }\n}\nexport const apiService = new ApiService();","map":{"version":3,"names":["axios","BACKEND_API_URL","MOCK_API_URL","ApiService","getStores","response","get","body","data","Array","isArray","stores","error","console","getDashboardSummary","getDashboardStore","storeId","getStoreMetrics","store_id","total_orders_24h","total_orders_1h","success_rate","failure_rate","avg_processing_time_minutes","total_revenue_24h","avg_order_value","orders_per_hour","error_breakdown","timestamp","Date","toISOString","getHealthScore","score","status","factors","processing_time","revenue_trend","getOrders","limit","params","orders","detectAnomalies","connectToOrderStream","onMessage","ws","WebSocket","onmessage","event","JSON","parse","type","onerror","apiService"],"sources":["C:/Users/Saksham/Loop/frontend/src/services/api.ts"],"sourcesContent":["import axios from 'axios';\nimport { Store, Order, StoreMetrics, HealthScore, Anomaly } from '../types';\n\n// API endpoints\nconst BACKEND_API_URL = 'http://localhost:8000';\nconst MOCK_API_URL = 'http://localhost:3001';\n\nclass ApiService {\n  // Fetch stores from mock API\n  async getStores(): Promise<Store[]> {\n    try {\n      // Prefer backend proxy so frontend only talks to our backend\n      const response = await axios.get(`${BACKEND_API_URL}/api/dashboard/stores`);\n      const body = response.data;\n      // Normalize possible shapes:\n      // - { stores: [...] }\n      // - [...] (array)\n      // - { data: [...] }\n      if (Array.isArray(body)) return body as Store[];\n      if (Array.isArray(body?.stores)) return body.stores as Store[];\n      if (Array.isArray(body?.data)) return body.data as Store[];\n      // fallback: try to extract enumerable array-like properties\n      return [];\n    } catch (error) {\n      console.error('Error fetching stores:', error);\n      throw error;\n    }\n  }\n\n  // Fetch dashboard summary from backend\n  async getDashboardSummary(): Promise<any> {\n    const response = await axios.get(`${BACKEND_API_URL}/api/dashboard/summary`);\n    return response.data;\n  }\n\n  // Fetch combined store info (store + orders + metrics)\n  async getDashboardStore(storeId: string): Promise<any> {\n    const response = await axios.get(`${BACKEND_API_URL}/api/dashboard/store/${storeId}`);\n    return response.data;\n  }\n\n  // Fetch store metrics from backend\n  async getStoreMetrics(storeId: string): Promise<StoreMetrics> {\n    try {\n      // TODO: Implement this to call your backend\n      const response = await axios.get(`${BACKEND_API_URL}/api/metrics/store/${storeId}`);\n      return response.data;\n    } catch (error) {\n      console.error('Error fetching metrics:', error);\n      // Return mock data for now\n      return {\n        store_id: storeId,\n        total_orders_24h: 0,\n        total_orders_1h: 0,\n        success_rate: 0,\n        failure_rate: 0,\n        avg_processing_time_minutes: 0,\n        total_revenue_24h: 0,\n        avg_order_value: 0,\n        orders_per_hour: 0,\n        error_breakdown: {},\n        timestamp: new Date().toISOString()\n      };\n    }\n  }\n\n  // Fetch health score from backend\n  async getHealthScore(storeId: string): Promise<HealthScore> {\n    try {\n      // TODO: Implement this to call your backend\n      const response = await axios.get(`${BACKEND_API_URL}/api/health-score/${storeId}`);\n      return response.data;\n    } catch (error) {\n      console.error('Error fetching health score:', error);\n      // Return mock data for now\n      return {\n        store_id: storeId,\n        score: 75,\n        status: 'healthy',\n        factors: {\n          success_rate: 85,\n          processing_time: 70,\n          revenue_trend: 75\n        },\n        timestamp: new Date().toISOString()\n      };\n    }\n  }\n\n  // Fetch orders from mock API\n  async getOrders(storeId: string, limit: number = 20): Promise<Order[]> {\n    try {\n      const response = await axios.get(`${MOCK_API_URL}/api/stores/${storeId}/orders`, {\n        params: { limit }\n      });\n      return response.data.orders;\n    } catch (error) {\n      console.error('Error fetching orders:', error);\n      return [];\n    }\n  }\n\n  // Detect anomalies\n  async detectAnomalies(storeId?: string): Promise<Anomaly[]> {\n    try {\n      // TODO: Implement this to call your backend\n      const response = await axios.get(`${BACKEND_API_URL}/api/anomalies/detect`, {\n        params: { store_id: storeId }\n      });\n      return response.data;\n    } catch (error) {\n      console.error('Error detecting anomalies:', error);\n      return [];\n    }\n  }\n\n  // Connect to WebSocket for real-time orders\n  connectToOrderStream(onMessage: (order: Order) => void): WebSocket {\n    const ws = new WebSocket('ws://localhost:8000/ws/orders');\n    \n    ws.onmessage = (event) => {\n      try {\n        const data = JSON.parse(event.data);\n        if (data.type === 'new_order') {\n          onMessage(data.data);\n        }\n      } catch (error) {\n        console.error('WebSocket message error:', error);\n      }\n    };\n\n    ws.onerror = (error) => {\n      console.error('WebSocket error:', error);\n    };\n\n    return ws;\n  }\n}\n\nexport const apiService = new ApiService();"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}